<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>easyinvoicing.ai – Free Invoice Preview</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f9fafb;
      --card-bg: #ffffff;
      --border: #e5e7eb;
      --border-strong: #d1d5db;
      --text-main: #111827;
      --text-muted: #6b7280;
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --radius-lg: 12px;
      --radius-md: 8px;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .page {
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }

    /* Header */

    .header {
      height: 64px;
      padding: 0 24px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: #ffffff;
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
    }

    .logo {
      font-weight: 700;
      font-size: 18px;
      letter-spacing: -0.03em;
    }

    .logo span:nth-child(2) {
      font-weight: 500;
    }

    .logo span.highlight {
      color: var(--primary);
      font-weight: 700;
    }

    .header-nav {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .nav-link {
      font-size: 14px;
      color: var(--text-muted);
      text-decoration: none;
    }

    .nav-link:hover {
      color: var(--text-main);
    }

    .btn-outline {
      padding: 6px 12px;
      font-size: 14px;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      background: #ffffff;
      cursor: pointer;
      color: var(--text-main);
    }

    .btn-primary {
      padding: 6px 14px;
      font-size: 14px;
      border-radius: 999px;
      border: none;
      background: var(--primary);
      color: #ffffff;
      cursor: pointer;
    }

    .btn-primary:disabled {
      opacity: 0.5;
      cursor: default;
    }

    .btn-primary:hover:not(:disabled) {
      background: #1d4ed8;
    }

    /* Layout */

    .main {
      flex: 1;
      padding: 24px;
      max-width: 1200px;
      margin: 0 auto;
      display: grid;
      grid-template-columns: minmax(0, 1.1fr) minmax(0, 1fr);
      gap: 24px;
    }

    .hero-left-heading {
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 8px;
    }

    .hero-left-subheading {
      font-size: 14px;
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 999px;
      background: var(--primary-soft);
      color: #1d4ed8;
      font-size: 12px;
      margin-bottom: 12px;
    }

    .pill-dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: #22c55e;
    }

    .panel {
      background: var(--card-bg);
      border-radius: var(--radius-lg);
      padding: 18px 18px 16px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.06);
      border: 1px solid var(--border);
    }

    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 12px;
    }

    .panel-title {
      font-size: 16px;
      font-weight: 600;
    }

    .panel-subtitle {
      font-size: 12px;
      color: var(--text-muted);
    }

    .badge {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      border: 1px solid var(--border-strong);
      color: var(--text-muted);
    }

    .badge-primary {
      border-color: #bfdbfe;
      background: var(--primary-soft);
      color: #1d4ed8;
      font-weight: 500;
    }

    /* Form */

    .form-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 16px;
      margin-bottom: 16px;
    }

    .form-row-full {
      grid-column: 1 / -1;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .field-label {
      font-size: 12px;
      color: var(--text-muted);
    }

    .field-input,
    .field-select,
    .field-textarea {
      font-size: 13px;
      padding: 7px 9px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      background: #ffffff;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .field-input:focus,
    .field-select:focus,
    .field-textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px var(--primary-soft);
    }

    .field-hint {
      font-size: 11px;
      color: var(--text-muted);
    }

    .field-textarea {
      resize: vertical;
      min-height: 60px;
    }

    .section-title {
      font-size: 13px;
      font-weight: 600;
      margin: 12px 0 8px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .section-title span.index {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 18px;
      height: 18px;
      border-radius: 999px;
      border: 1px solid var(--border-strong);
      font-size: 11px;
      margin-right: 6px;
    }

    .section-title-main {
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .section-title-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .meta-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 8px;
    }

    /* Items table */

    .items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      margin-bottom: 4px;
      font-size: 12px;
      border-radius: var(--radius-md);
      overflow: hidden;
      border: 1px solid var(--border-strong);
    }

    .items-table thead {
      background: #f3f4f6;
    }

    .items-table th,
    .items-table td {
      padding: 6px 8px;
      border-bottom: 1px solid var(--border);
      text-align: left;
    }

    .items-table th:last-child,
    .items-table td:last-child {
      text-align: right;
      white-space: nowrap;
    }

    .items-table th:nth-child(1),
    .items-table td:nth-child(1) {
      width: 28px;
      text-align: center;
    }

    .items-table th:nth-child(3),
    .items-table th:nth-child(4),
    .items-table th:nth-child(5),
    .items-table td:nth-child(3),
    .items-table td:nth-child(4),
    .items-table td:nth-child(5) {
      white-space: nowrap;
    }

    .items-input {
      width: 100%;
      border: none;
      outline: none;
      background: transparent;
      font-size: 12px;
      padding: 2px 0;
    }

    .items-input::placeholder {
      color: #9ca3af;
    }

    .items-input[type="number"] {
      text-align: right;
    }

    .items-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 6px;
    }

    .link-button {
      border: none;
      background: transparent;
      color: var(--primary);
      font-size: 12px;
      padding: 0;
      cursor: pointer;
    }

    .link-button:disabled {
      opacity: 0.4;
      cursor: default;
    }

    .summary-grid {
      display: grid;
      grid-template-columns: 2fr 1.2fr;
      gap: 12px;
      margin-top: 10px;
    }

    .summary-box {
      border-radius: var(--radius-md);
      border: 1px dashed var(--border-strong);
      padding: 8px 10px;
      font-size: 12px;
    }

    .summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 4px;
    }

    .summary-label {
      color: var(--text-muted);
    }

    .summary-value {
      font-weight: 500;
    }

    .notes-field {
      font-size: 12px;
      width: 100%;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-strong);
      padding: 7px 9px;
      resize: vertical;
      min-height: 52px;
    }

    .generate-footer {
      display: flex;
      justify-content: flex-end;
      margin-top: 12px;
      gap: 8px;
      align-items: center;
      flex-wrap: wrap;
    }

    .hint-small {
      font-size: 11px;
      color: var(--text-muted);
    }

    /* Preview pane */

    .preview-panel {
      background: transparent;
      padding: 0;
      box-shadow: none;
      border: none;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .preview-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-header-title {
      font-size: 14px;
      font-weight: 600;
    }

    .preview-header-sub {
      font-size: 11px;
      color: var(--text-muted);
    }

    .preview-canvas-wrapper {
      border-radius: var(--radius-lg);
      border: 1px solid var(--border-strong);
      background: #e5e7eb;
      padding: 10px;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .preview-page {
      width: 100%;
      max-width: 816px; /* increased */
      aspect-ratio: 210 / 297;
      background: #ffffff;
      border-radius: 4px;
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.15);
      padding: 18px 22px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      font-size: 11px;
      border: 1px solid #d1d5db; /* thin border on screen */
    }

    .preview-page-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 10px;
    }

    .preview-page-title {
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.06em;
    }

    .preview-page-meta {
      text-align: right;
      font-size: 10px;
      color: var(--text-muted);
    }

    .preview-blocks {
      display: flex;
      gap: 12px;
      margin-bottom: 10px;
    }

    .preview-block {
      flex: 1;
    }

    .preview-block-label {
      font-weight: 600;
      margin-bottom: 3px;
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .preview-block-line {
      font-size: 11px;
      line-height: 1.4;
    }

    .preview-items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 6px;
      font-size: 10px;
    }

    .preview-items-table th,
    .preview-items-table td {
      border-bottom: 1px solid #e5e7eb;
      padding: 4px 3px;
    }

    .preview-items-table th {
      text-align: left;
      background: #f9fafb;
      font-weight: 600;
    }

    .preview-items-table th:nth-child(1),
    .preview-items-table td:nth-child(1) {
      width: 16px;
      text-align: center;
    }

    .preview-items-table th:nth-child(3),
    .preview-items-table th:nth-child(4),
    .preview-items-table th:nth-child(5),
    .preview-items-table td:nth-child(3),
    .preview-items-table td:nth-child(4),
    .preview-items-table td:nth-child(5) {
      text-align: right;
      white-space: nowrap;
    }

    .preview-summary {
      margin-top: 10px;
      margin-left: auto;
      font-size: 10px;
      width: 55%;
    }

    .preview-summary-row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 3px;
    }

    .preview-summary-row.total {
      font-weight: 600;
      border-top: 1px solid #e5e7eb;
      padding-top: 4px;
      margin-top: 3px;
    }

    .preview-notes {
      margin-top: 10px;
      font-size: 10px;
      color: var(--text-muted);
    }

    .preview-country-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      border-radius: 999px;
      padding: 2px 6px;
      background: #f3f4f6;
      font-size: 9px;
      margin-top: 3px;
    }

    /* Print */

    @page {
      size: A4;
      margin: 0;
    }

    @media print {
      html,
      body {
        width: 210mm;
        height: 297mm;
        margin: 0;
        padding: 0;
        background: #ffffff;
      }

      .page {
        min-height: 0;
      }

      /* hide header and left form */
      .header,
      .main > section:first-child {
        display: none !important;
      }

      .main {
        display: block;
        padding: 0;
        margin: 0;
        max-width: none;
      }

      .preview-panel {
        display: block;
        padding: 0;
        margin: 0;
      }

      .preview-canvas-wrapper {
        border: none;
        padding: 0;
        margin: 0;
        display: block;
      }

      .preview-page {
        box-shadow: none !important;
        border-radius: 0;
        border: 0.5pt solid #111827; /* thin border in print */
        width: 210mm;
        height: 297mm;
        padding: 15mm 18mm; /* page margins */
        margin: 0;
      }

      /* hide preview header/title so printed page starts with INVOICE */
      .preview-header {
        display: none !important;
      }
      .preview-header-sub {
        display: none !important;
      }
      .preview-page-meta {
        display: none !important;
      }
    }

    /* Responsive */

    @media (max-width: 960px) {
      .main {
        grid-template-columns: minmax(0, 1fr);
      }
    }

    @media (max-width: 640px) {
      .header {
        padding: 0 16px;
      }

      .header-nav {
        display: none;
      }

      .main {
        padding: 16px;
      }

      .hero-left-heading {
        font-size: 22px;
      }

      .panel {
        padding: 14px 12px;
      }

      .preview-page {
        padding: 14px 14px;
      }
    }
  </style>
</head>
<body>
<div class="page">
  <header class="header">
    <div class="logo">
      <span>invoice</span><span>to</span><span class="highlight">.app</span>
    </div>
    <nav class="header-nav">
      <a href="hiwig.html" class="nav-link">How it works</a>
      <a href="#" class="nav-link">Pricing</a>
      <button class="btn-outline" type="button">Sign in</button>
      <button class="btn-primary" type="button" disabled>Go Pro</button>
    </nav>
  </header>

  <main class="main">
    <!-- LEFT: Form -->
    <section>
      <div class="pill">
        <span class="pill-dot"></span>
        Free invoice preview · No signup
      </div>
      <h1 class="hero-left-heading">Create clean internationally compliant invoices in seconds</h1>
      <p class="hero-left-subheading">
        Fill in your company and client details, add up to 10 lines of work
        and instantly preview your invoice in A4 format. All amounts are shown in the currency you choose.
      </p>

      <div class="panel">
        <header class="panel-header">
          <div>
            <div class="panel-title">Free invoice generator</div>
            <div class="panel-subtitle">
              Your data stays in this browser session only.
            </div>
          </div>
          <span class="badge badge-primary">Basic international template</span>
        </header>

        <!-- Supplier country, currency, tax label, rate -->
        <div class="form-grid form-row-full" style="margin-bottom: 6px;">
          <div class="field">
            <label class="field-label" for="supplierCountry">Supplier country</label>
            <input id="supplierCountry" class="field-input" placeholder="e.g. Czech Republic" />
            <div class="field-hint">
              Used for invoice labeling only.
            </div>
          </div>
          <div class="field">
            <label class="field-label" for="clientCountry">Client country</label>
            <input id="clientCountry" class="field-input" placeholder="e.g. Germany" />
            <div class="field-hint">
              Shown on invoice; VAT logic uses VAT numbers, not this field.
            </div>
          </div>
          <div class="field">
            <label class="field-label" for="currency">Currency</label>
            <input id="currency" class="field-input" value="EUR" />
            <div class="field-hint">
              Currency code shown on invoice (e.g. EUR, USD, GBP).
            </div>
          </div>
          <div class="field">
            <label class="field-label" for="taxLabel">Tax label</label>
            <input id="taxLabel" class="field-input" value="VAT" />
            <div class="field-hint">
              Name of the tax: VAT, TAX, DPH, IVA, GST, etc.
            </div>
          </div>
          <div class="field">
            <label class="field-label" for="taxRate">Tax rate (%)</label>
            <input id="taxRate" class="field-input" type="number" min="0" step="0.01" placeholder="e.g. 21" />
            <div class="field-hint">
              Used when tax applies and is not zero-rated.
            </div>
          </div>
        </div>

        <!-- Supplier -->
        <div class="section-title">
          <div class="section-title-main">
            <span class="index">1</span>
            <span>Supplier (your company)</span>
          </div>
        </div>
        <div class="form-grid">
          <div class="field form-row-full">
            <label class="field-label" for="supplierName">Company name</label>
            <input id="supplierName" class="field-input" placeholder="Your company s.r.o." />
          </div>
          <div class="field form-row-full">
            <label class="field-label" for="supplierAddress">Address</label>
            <input id="supplierAddress" class="field-input" placeholder="Street, ZIP, City, Country" />
          </div>
          <div class="field">
            <label class="field-label" for="supplierTax">Tax number (supplier)</label>
            <input id="supplierTax" class="field-input" placeholder="e.g. CZ12345678" />
          </div>
          <div class="field">
            <label class="field-label" for="supplierIban">IBAN</label>
            <input id="supplierIban" class="field-input" placeholder="e.g. CZ65 0800 0000 0000 1234 5678" />
          </div>
          <div class="field">
            <label class="field-label" for="supplierBank">Bank name</label>
            <input id="supplierBank" class="field-input" placeholder="e.g. Česká spořitelna, a.s." />
          </div>
          <div class="field">
            <label class="field-label" for="supplierBic">BIC / SWIFT</label>
            <input id="supplierBic" class="field-input" placeholder="e.g. GIBACZPX" />
          </div>
        </div>

        <!-- Client -->
        <div class="section-title">
          <div class="section-title-main">
            <span class="index">2</span>
            <span>Client (payer)</span>
          </div>
        </div>
        <div class="form-grid">
          <div class="field form-row-full">
            <label class="field-label" for="clientName">Client name</label>
            <input id="clientName" class="field-input" placeholder="Client GmbH" />
          </div>
          <div class="field form-row-full">
            <label class="field-label" for="clientAddress">Client address</label>
            <input id="clientAddress" class="field-input" placeholder="Street, ZIP, City, Country" />
          </div>
          <div class="field">
            <label class="field-label" for="clientTax">Tax number (client)</label>
            <input id="clientTax" class="field-input" placeholder="Leave empty if not registered" />
          </div>
        </div>

        <!-- Invoice meta -->
        <div class="section-title">
          <div class="section-title-main">
            <span class="index">3</span>
            <span>Invoice details</span>
          </div>
        </div>
        <div class="meta-grid">
          <div class="field">
            <label class="field-label" for="invoiceNumber">Invoice number</label>
            <input id="invoiceNumber" class="field-input" placeholder="2025-001" />
          </div>
          <div class="field">
            <label class="field-label" for="issueDate">Issue date</label>
            <input id="issueDate" class="field-input" type="date" />
          </div>
          <div class="field">
            <label class="field-label" for="dueDate">Due date</label>
            <input id="dueDate" class="field-input" type="date" />
          </div>
        </div>

        <!-- Items -->
        <div class="section-title">
          <div class="section-title-main">
            <span class="index">4</span>
            <span>Invoice items</span>
          </div>
          <span class="section-title-sub">Up to 10 lines of work</span>
        </div>

        <table class="items-table">
          <thead>
          <tr>
            <th>#</th>
            <th>Description</th>
            <th>Qty</th>
            <th>Unit price</th>
            <th>Line total</th>
          </tr>
          </thead>
          <tbody id="itemsBody">
          <!-- rows will be injected by JS -->
          </tbody>
        </table>
        <div class="items-footer">
          <button id="addItemBtn" class="link-button" type="button">+ Add line</button>
          <span class="field-hint">You can add up to 10 lines.</span>
        </div>

        <!-- Summary & notes -->
        <div class="summary-grid">
          <div>
            <div class="field-label" style="margin-bottom:4px;">Notes (optional)</div>
            <textarea id="notes" class="notes-field" placeholder="Payment within 14 days by bank transfer. Thank you for your business."></textarea>
          </div>
          <div class="summary-box">
            <div class="summary-row">
              <span class="summary-label">Net amount (<span id="summaryCurrency1">EUR</span>)</span>
              <span class="summary-value" id="netAmount">0.00</span>
            </div>
            <div class="summary-row">
              <span class="summary-label"><span id="summaryTaxLabel">Tax</span> rate</span>
              <span class="summary-value" id="taxRateText">not applied</span>
            </div>
            <div class="summary-row">
              <span class="summary-label"><span id="summaryTaxLabel2">Tax</span> amount (<span id="summaryCurrency2">EUR</span>)</span>
              <span class="summary-value" id="taxAmount">0.00</span>
            </div>
            <div class="summary-row total">
              <span class="summary-label">Total due (<span id="summaryCurrency3">EUR</span>)</span>
              <span class="summary-value" id="totalAmount">0.00</span>
            </div>
          </div>
        </div>

        <div class="generate-footer">
          <span class="hint-small">You can preview the invoice and then export it to PDF using your browser print dialog.</span>
          <button id="printBtn" class="btn-outline" type="button">
            Export to PDF
          </button>
          <button id="generateBtn" class="btn-primary" type="button">
            Generate preview
          </button>
        </div>
      </div>
    </section>

    <!-- RIGHT: Preview -->
    <section class="preview-panel">
      <div class="preview-header">
        <div>
          <div class="preview-header-title">Invoice preview (A4)</div>
          <div class="preview-header-sub">
            Updated when you change fields or click “Generate preview”.
          </div>
        </div>
      </div>

      <div class="preview-canvas-wrapper">
        <div class="preview-page">
          <div class="preview-page-header">
            <div>
              <div class="preview-page-title">INVOICE</div>
              <div class="preview-country-tag">
                <span id="previewCountryCode">INT</span>
                <span>· <span id="previewCurrencyTag">EUR</span></span>
              </div>
            </div>
            <div class="preview-page-meta" id="previewMeta">
              Invoice No: —<br />
              Issue date: —<br />
              Due date: —
            </div>
          </div>

          <div class="preview-blocks">
            <div class="preview-block">
              <div class="preview-block-label">SUPPLIER</div>
              <div class="preview-block-line" id="previewSupplierName">Your company s.r.o.</div>
              <div class="preview-block-line" id="previewSupplierAddress">Street, City</div>
              <div class="preview-block-line" id="previewSupplierBank">Bank: —</div>
              <div class="preview-block-line" id="previewSupplierIban">IBAN: —</div>
              <div class="preview-block-line" id="previewSupplierBic">BIC: —</div>
              <div class="preview-block-line" id="previewSupplierTax">Tax: —</div>
            </div>
            <div class="preview-block">
              <div class="preview-block-label">BILL TO</div>
              <div class="preview-block-line" id="previewClientName">Client GmbH</div>
              <div class="preview-block-line" id="previewClientAddress">Street, City</div>
              <div class="preview-block-line" id="previewClientTax">Tax: —</div>
            </div>
          </div>

          <table class="preview-items-table">
            <thead>
            <tr>
              <th>#</th>
              <th>Description</th>
              <th>Qty</th>
              <th>Unit price</th>
              <th>Total</th>
            </tr>
            </thead>
            <tbody id="previewItemsBody">
            <tr>
              <td colspan="5" style="font-style: italic; color:#9ca3af; text-align: center;">
                No items yet. Add lines on the left.
              </td>
            </tr>
            </tbody>
          </table>

          <div class="preview-summary">
            <div class="preview-summary-row">
              <span>Net amount (<span id="previewCurrency1">EUR</span>)</span>
              <span id="previewNetAmount">0.00</span>
            </div>
            <div class="preview-summary-row">
              <span id="previewTaxLineLabel">Tax</span>
              <span id="previewTaxAmount">not applied</span>
            </div>
            <div class="preview-summary-row total">
              <span>Total due (<span id="previewCurrency2">EUR</span>)</span>
              <span id="previewTotalAmount">0.00</span>
            </div>
          </div>

          <div class="preview-notes">
            <strong>Notes / Payment terms</strong><br />
            <span id="previewNotes">
              Payment within 14 days by bank transfer. Thank you for your business.
            </span>
          </div>
        </div>
      </div>
    </section>
  </main>
</div>

<script>
  const MAX_ITEMS = 10;
  const itemsBody = document.getElementById("itemsBody");
  const addItemBtn = document.getElementById("addItemBtn");
  const generateBtn = document.getElementById("generateBtn");
  const printBtn = document.getElementById("printBtn");

  function createItemRow(index) {
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${index}</td>
      <td><input class="items-input item-desc" placeholder="Description" /></td>
      <td><input class="items-input item-qty" type="number" min="0" step="0.01" placeholder="0" /></td>
      <td><input class="items-input item-price" type="number" min="0" step="0.01" placeholder="0.00" /></td>
      <td class="item-total-cell">0.00</td>
    `;
    return tr;
  }

  function initItemsTable() {
    itemsBody.innerHTML = "";
    for (let i = 1; i <= 3; i++) {
      itemsBody.appendChild(createItemRow(i));
    }
    ensureAddButtonState();
  }

  function ensureAddButtonState() {
    const rows = itemsBody.querySelectorAll("tr");
    addItemBtn.disabled = rows.length >= MAX_ITEMS;
  }

  function addItemRow() {
    const rows = itemsBody.querySelectorAll("tr");
    const idx = rows.length + 1;
    if (idx > MAX_ITEMS) return;
    itemsBody.appendChild(createItemRow(idx));
    ensureAddButtonState();
  }

  function parseNumber(value) {
    const n = parseFloat(String(value).replace(",", "."));
    if (Number.isNaN(n)) return 0;
    return n;
  }

  function formatNumber(num) {
    return num.toFixed(2);
  }

  // New VAT logic per user's request:
  // - VAT numbers are expected to start with a 2-letter country code (A-Z).
  // - If VAT number does not start with 2 letters, it's treated as "no country code" -> VAT rules don't apply.
  // - If both supplier and client have codes and codes are different -> reverse charge (0%).
  // - If codes are same -> VAT applies at entered rate.
  // - If client has VAT code but supplier does not -> VAT applies at entered rate.
  // - If neither has valid vat code -> VAT not applied.
  function extractVatCountryCode(vatRaw) {
    if (!vatRaw) return null;
    const s = vatRaw.trim().toUpperCase();
    if (/^[A-Z]{2}/.test(s)) {
      return s.slice(0,2);
    }
    return null;
  }

  function recalcItemsAndTotals() {
    const rows = itemsBody.querySelectorAll("tr");
    let net = 0;

    rows.forEach((row, i) => {
      const qtyInput = row.querySelector(".item-qty");
      const priceInput = row.querySelector(".item-price");
      const totalCell = row.querySelector(".item-total-cell");

      const qty = parseNumber(qtyInput.value || "0");
      const price = parseNumber(priceInput.value || "0");
      const lineTotal = qty * price;
      totalCell.textContent = formatNumber(lineTotal);
      net += lineTotal;

      row.firstElementChild.textContent = i + 1;
    });

    const supplierTax = document.getElementById("supplierTax").value.trim();
    const clientTax   = document.getElementById("clientTax").value.trim();
    const taxLabelRaw = document.getElementById("taxLabel").value.trim() || "Tax";
    const baseRate    = parseNumber(document.getElementById("taxRate").value || "0");

    const supCode = extractVatCountryCode(supplierTax);
    const cliCode = extractVatCountryCode(clientTax);

    let effectiveRate = 0;
    let taxApplies = false;
    let taxNote = "not applied";

    // If neither has valid country code -> VAT rules do not apply
    if (!supCode && !cliCode) {
      taxApplies = false;
      effectiveRate = 0;
      taxNote = `${taxLabelRaw} not applied`;
    } else if (supCode && cliCode) {
      // both have codes
      if (supCode !== cliCode) {
        // reverse charge / zero-rated
        taxApplies = false;
        effectiveRate = 0;
        taxNote = `${taxLabelRaw} 0 % (reverse charge)`;
      } else {
        // same country code -> tax applies at rate
        taxApplies = true;
        effectiveRate = baseRate;
        taxNote = `${taxLabelRaw} ${effectiveRate} %`;
      }
    } else if (!supCode && cliCode) {
      // client has VAT code, supplier does NOT -> VAT is added per user's spec
      taxApplies = true;
      effectiveRate = baseRate;
      taxNote = `${taxLabelRaw} ${effectiveRate} % (client VAT present, supplier missing)`;
    } else if (supCode && !cliCode) {
      // supplier has VAT code, client does NOT -> VAT applies
      taxApplies = true;
      effectiveRate = baseRate;
      taxNote = `${taxLabelRaw} ${effectiveRate} % (supplier VAT present, client missing)`;
    }

    const taxAmount = taxApplies ? (net * effectiveRate) / 100 : 0;
    const gross = net + taxAmount;

    // Update form summary
    document.getElementById("netAmount").textContent   = formatNumber(net);
    document.getElementById("taxAmount").textContent   = formatNumber(taxAmount);
    document.getElementById("totalAmount").textContent = formatNumber(gross);

    document.getElementById("summaryTaxLabel").textContent  = taxLabelRaw;
    document.getElementById("summaryTaxLabel2").textContent = taxLabelRaw;
    document.getElementById("taxRateText").textContent = taxNote;

    // Preview summary
    document.getElementById("previewNetAmount").textContent   = formatNumber(net);
    document.getElementById("previewTotalAmount").textContent = formatNumber(gross);
    document.getElementById("previewTaxLineLabel").textContent = taxLabelRaw;

    if (!taxApplies) {
      // show clear messages for zero/none
      if (supCode && cliCode && supCode !== cliCode) {
        document.getElementById("previewTaxAmount").textContent = `0.00 (0 %)`;
      } else {
        document.getElementById("previewTaxAmount").textContent = "not applied";
      }
    } else {
      document.getElementById("previewTaxAmount").textContent =
        `${formatNumber(taxAmount)} (${effectiveRate} %)`;
    }

    updatePreviewItems();
    updatePreviewSupplierClientTax(taxLabelRaw, supplierTax, clientTax);
  }

  function updatePreviewSupplierClientTax(taxLabel, supplierTax, clientTax) {
    document.getElementById("previewSupplierTax").textContent =
      `${taxLabel}: ${supplierTax || "—"}`;
    document.getElementById("previewClientTax").textContent =
      `${taxLabel}: ${clientTax || "—"}`;
  }

  function updatePreviewMeta() {
    const invoiceNumber =
      document.getElementById("invoiceNumber").value.trim() || "—";
    const issueDate =
      document.getElementById("issueDate").value.trim() || "—";
    const dueDate = document.getElementById("dueDate").value.trim() || "—";

    document.getElementById("previewMeta").innerHTML =
      "Invoice No: " +
      escapeHtml(invoiceNumber) +
      "<br />Issue date: " +
      escapeHtml(issueDate) +
      "<br />Due date: " +
      escapeHtml(dueDate);
  }

  function updatePreviewSupplierClient() {
    const supplierName =
      document.getElementById("supplierName").value.trim() ||
      "Your company s.r.o.";
    const supplierAddress =
      document.getElementById("supplierAddress").value.trim() ||
      "Street, City";
    const supplierBank = document
      .getElementById("supplierBank")
      .value.trim();
    const supplierIban = document
      .getElementById("supplierIban")
      .value.trim();
    const supplierBic = document.getElementById("supplierBic").value.trim();
    const supplierTax = document.getElementById("supplierTax").value.trim();

    const clientName =
      document.getElementById("clientName").value.trim() || "Client GmbH";
    const clientAddress =
      document.getElementById("clientAddress").value.trim() || "Street, City";
    const clientTax = document.getElementById("clientTax").value.trim();
    const taxLabelRaw = document.getElementById("taxLabel").value.trim() || "Tax";

    document.getElementById("previewSupplierName").textContent =
      supplierName;
    document.getElementById("previewSupplierAddress").textContent =
      supplierAddress;
    document.getElementById("previewSupplierBank").textContent =
      "Bank: " + (supplierBank || "—");
    document.getElementById("previewSupplierIban").textContent =
      "IBAN: " + (supplierIban || "—");
    document.getElementById("previewSupplierBic").textContent =
      "BIC: " + (supplierBic || "—");
    document.getElementById("previewSupplierTax").textContent =
      `${taxLabelRaw}: ${supplierTax || "—"}`;

    document.getElementById("previewClientName").textContent = clientName;
    document.getElementById("previewClientAddress").textContent =
      clientAddress;
    document.getElementById("previewClientTax").textContent =
      `${taxLabelRaw}: ${clientTax || "—"}`;
  }

  function updatePreviewCountryAndCurrency() {
    const country = document.getElementById("supplierCountry").value.trim();
    const codeEl = document.getElementById("previewCountryCode");
    // keep INT if no ISO mapping available (we removed the mapping)
    codeEl.textContent = (country || "INT").toUpperCase();

    const rawCur = document.getElementById("currency").value.trim() || "EUR";
    const cur = rawCur.toUpperCase();

    document.getElementById("summaryCurrency1").textContent = cur;
    document.getElementById("summaryCurrency2").textContent = cur;
    document.getElementById("summaryCurrency3").textContent = cur;

    document.getElementById("previewCurrencyTag").textContent = cur;
    document.getElementById("previewCurrency1").textContent   = cur;
    document.getElementById("previewCurrency2").textContent   = cur;
  }

  function updatePreviewItems() {
    const previewBody = document.getElementById("previewItemsBody");
    const rows = itemsBody.querySelectorAll("tr");
    previewBody.innerHTML = "";

    const visibleRows = [];
    rows.forEach((row, idx) => {
      const desc = row.querySelector(".item-desc").value.trim();
      const qty = row.querySelector(".item-qty").value.trim();
      const price = row.querySelector(".item-price").value.trim();
      const total = row.querySelector(".item-total-cell").textContent.trim();

      if (!desc && !qty && !price && total === "0.00") {
        return;
      }

      visibleRows.push({ idx: idx + 1, desc, qty, price, total });
    });

    if (visibleRows.length === 0) {
      const tr = document.createElement("tr");
      tr.innerHTML =
        '<td colspan="5" style="font-style: italic; color:#9ca3af; text-align: center;">No items yet. Add lines on the left.</td>';
      previewBody.appendChild(tr);
      return;
    }

    visibleRows.forEach((item) => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${item.idx}</td>
        <td>${escapeHtml(item.desc || "")}</td>
        <td style="text-align:right;">${item.qty || ""}</td>
        <td style="text-align:right;">${item.price || ""}</td>
        <td style="text-align:right;">${item.total || "0.00"}</td>
      `;
      previewBody.appendChild(tr);
    });
  }

  function updatePreviewNotes() {
    const notes = document.getElementById("notes").value.trim();
    document.getElementById("previewNotes").textContent =
      notes ||
      "Payment within 14 days by bank transfer. Thank you for your business.";
  }

  function updateAllPreview() {
    updatePreviewMeta();
    updatePreviewSupplierClient();
    updatePreviewCountryAndCurrency();
    recalcItemsAndTotals();
    updatePreviewNotes();
  }

  function escapeHtml(str) {
    return String(str)
      .replace(/&/g, "&amp;")
      .replace(/</g, "&lt;")
      .replace(/>/g, "&gt;")
      .replace(/"/g, "&quot;")
      .replace(/'/g, "&#039;");
  }

  function autoFillDates() {
    const issueDateEl = document.getElementById("issueDate");
    const dueDateEl = document.getElementById("dueDate");
    const today = new Date();
    const yyyy = today.getFullYear();
    const mm = String(today.getMonth() + 1).padStart(2, "0");
    const dd = String(today.getDate()).padStart(2, "0");
    issueDateEl.value = `${yyyy}-${mm}-${dd}`;

    const due = new Date(today);
    due.setDate(due.getDate() + 14);
    const yyyy2 = due.getFullYear();
    const mm2 = String(due.getMonth() + 1).padStart(2, "0");
    const dd2 = String(due.getDate()).padStart(2, "0");
    dueDateEl.value = `${yyyy2}-${mm2}-${dd2}`;
  }

  // Event wiring

  addItemBtn.addEventListener("click", () => {
    addItemRow();
    hookItemInputs();
    recalcItemsAndTotals();
  });

  generateBtn.addEventListener("click", () => {
    updateAllPreview();
  });

  printBtn.addEventListener("click", () => {
    updateAllPreview();
    window.print();
  });

  function hookInputs() {
    const ids = [
      "supplierName",
      "supplierAddress",
      "supplierBank",
      "supplierIban",
      "supplierBic",
      "supplierTax",
      "supplierCountry",
      "clientName",
      "clientAddress",
      "clientCountry",
      "clientTax",
      "invoiceNumber",
      "issueDate",
      "dueDate",
      "notes",
      "currency",
      "taxLabel",
      "taxRate"
    ];

    ids.forEach((id) => {
      const el = document.getElementById(id);
      if (!el) return;
      el.addEventListener("input", () => {
        updateAllPreview();
      });
    });
  }

  function hookItemInputs() {
    const rows = itemsBody.querySelectorAll("tr");
    rows.forEach((row) => {
      const inputs = row.querySelectorAll(".items-input");
      inputs.forEach((input) => {
        input.removeEventListener("input", recalcItemsAndTotals);
        input.addEventListener("input", recalcItemsAndTotals);
      });
    });
  }

  // Init
  initItemsTable();
  autoFillDates();
  hookInputs();
  hookItemInputs();
  updateAllPreview();
</script>
</body>
</html>
